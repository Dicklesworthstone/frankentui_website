{"id":"bd-17l","title":"beads-viewer: Mobile Tables + Revision Legend + UX/Test Hardening","description":"CONTEXT\n- The static beads viewer lives at public/beads-viewer/index.html and renders markdown (marked + DOMPurify) into .prose blocks (issue descriptions, graph node details, etc.).\n- On mobile, markdown tables (the 'ledger' style tables we use in writeups) are currently hard to read: the first column collapses too far, tables look broken, and users feel pushed into horizontal scrolling.\n- We also need a clear, mobile-friendly legend for the 'revision type' indicator (10 categories), with hover tooltip on desktop and an interaction that works on touch devices.\n\nGOALS (USER-VISIBLE)\n1) Mobile markdown tables are readable by default.\n   - No required horizontal scrolling.\n   - The first column never collapses into unreadable slivers.\n   - Dense tables degrade gracefully without losing information.\n2) Revision type is understandable at a glance.\n   - Desktop: hover tooltip.\n   - Mobile: tap-to-open legend (bottom sheet / popover) with the full mapping of the 10 categories.\n3) Add obviously accretive functionality around these areas (table interactions + revision ledger UX) without making the viewer fragile.\n4) Ship with rigorous tests + diagnostics logging so regressions are caught immediately.\n\nNON-GOALS\n- No rewrite of the viewer stack (still static, still sql.js, still offline-friendly).\n- No dependency bloat unless it is clearly the simplest/most robust option.\n\nTECHNICAL CONSTRAINTS\n- Must stay compatible with current CSP/offline model (self-contained assets in public/beads-viewer).\n- Preserve security posture: sanitize markdown output (DOMPurify) and do not introduce XSS surfaces.\n\nQUALITY BAR\n- Unit tests for: table postprocessing logic, revision-type parsing/mapping, and any new UI state reducers/helpers.\n- E2E tests (Playwright) for: mobile viewport rendering, table layout behavior, legend interaction on touch, and 'no console errors' guard.\n- Detailed test logging: JSONL logs with env, viewport, timings, console events, and deterministic run mode.\n\nDELIVERABLE\n- A coherent set of sub-beads with dependency structure that implements all the above, plus deployment verification on Vercel.","status":"open","priority":1,"issue_type":"epic","created_at":"2026-02-08T16:56:12.667107352Z","created_by":"ubuntu","updated_at":"2026-02-08T16:56:12.667107352Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-17l.1","title":"Mobile Markdown Tables: No-Side-Scroll Responsive Layout","description":"PROBLEM\n- Markdown tables rendered inside .prose (issue descriptions, graph detail panes) look broken on small screens.\n- The first column collapses too aggressively, producing unreadable 'vertical text' or extreme wrapping.\n\nGOAL\n- Make tables readable on mobile with zero required horizontal scrolling.\n\nDESIGN (HIGH LEVEL)\n- Treat tables differently by shape:\n  1) 2-column tables (key/value): on mobile, render each row as a compact card with key on top and value below (no columns).\n  2) 3+ column tables (matrix): on mobile, render each row as a stacked set of label/value pairs using header-derived labels.\n- Preserve semantics and information density on desktop (normal table layout), but never let mobile collapse into unreadable geometry.\n- Ensure behavior is deterministic and compatible with DOMPurify sanitization.\n\nACCEPTANCE CRITERIA\n- On a 390x844 viewport (iPhone 12-ish), tables are readable:\n  - No horizontal scrollbars needed for normal use.\n  - First-column content is legible and does not collapse below a sane minimum.\n- Desktop layout remains table-like and visually consistent.\n- Works for tables produced by marked's GFM output.\n\nTESTING\n- Unit tests for table DOM postprocessing (header extraction, cell labeling, shape classification).\n- E2E tests that load an issue containing representative 2-col and 3+ col tables and verify mobile styling.\n\nIMPLEMENTATION NOTE\n- Likely requires post-processing sanitized DOM in renderMarkdown() to add data-label attributes and table shape classes.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-08T16:56:24.781984601Z","created_by":"ubuntu","updated_at":"2026-02-09T00:59:22.234096215Z","closed_at":"2026-02-09T00:59:22.234077810Z","close_reason":"All 5 sub-beads closed: repro/fixtures, table postprocessing, mobile CSS, view toggle/export, and a11y. Mobile tables now responsive with sr-only headers, data-labels, card/table toggle, TSV copy, CSV export.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17l.1","depends_on_id":"bd-17l","type":"parent-child","created_at":"2026-02-08T16:56:24.781984601Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-17l.1.1","title":"Repro: Identify Broken Mobile Tables + Capture Fixtures","description":"WHY\nWe need to fix the right thing. Table breakage can differ by table shape (2-col vs 3+ col), content (long tokens, URLs, code), and container (issue modal vs graph detail).\n\nWHAT TO DO\n- Load public/beads-viewer/ in a mobile viewport and find at least:\n  1) A representative 2-column key/value markdown table.\n  2) A representative 3+ column markdown table.\n  3) A pathological case: long unbroken tokens, long IDs, or inline code.\n- Capture screenshots (before) and note the issue IDs where these descriptions appear.\n- Record which view(s) render them (issue modal description, graph detail, etc.).\n\nACCEPTANCE CRITERIA\n- We have 3 concrete fixture tables with issue IDs and 'expected' notes, ready to use in E2E tests.\n\nOUTPUT\n- Update this bead with the fixture IDs and short notes once found.","notes":"Fixture discovery completed on mobile viewport (390x844), using `public/beads-viewer/index.html` issue-detail modal (`#/issue/<id>`).\n\nFixtures identified:\n1) 2-column key/value table fixture\n- Issue ID: `bd-10i.12.2`\n- View/container: issue description modal (`#/issue/bd-10i.12.2`)\n- Observed table shape: 2 columns (`Term`, `Definition`), class `bv-table bv-table--2col`\n- Before screenshot: `/tmp/bd-10i.12.2-mobile-before.png`\n- Expected mobile behavior note: render as readable key/value cards with no forced horizontal scroll and no first-column collapse.\n\n2) Dense 3+ column matrix fixture\n- Issue ID: `bd-1un`\n- View/container: issue description modal (`#/issue/bd-1un`)\n- Observed table shape: 8 columns (`Feature`, `Kitty`, `WezTerm`, `Alacritty`, `Ghostty`, `iTerm2`, `GNOME Term`, `Win Term`), class `bv-table bv-table--ncol`\n- Before screenshot: `/tmp/bd-1un-mobile-before.png`\n- Expected mobile behavior note: stacked/labelled row rendering that preserves all columns without readability collapse.\n\n3) Pathological long-token fixture (long snake_case IDs in first column)\n- Issue ID: `bd-2ky9`\n- View/container: issue description modal (`#/issue/bd-2ky9`)\n- Observed table shape: 3 columns (`Test`, `Description`, `Priority`) with long unbroken identifiers (e.g., `altscreen_enter_exit`, `inline_log_scroll`) in column 1, class `bv-table bv-table--ncol`\n- Before screenshot: `/tmp/bd-2ky9-mobile-before.png`\n- Expected mobile behavior note: long tokens remain legible (no unreadable slivers/overlap), labels preserved, no page-level horizontal scroll.\n\nSummary:\n- All three fixtures are reproducible in issue-modal description rendering.\n- These three IDs are suitable anchors for responsive table E2E assertions and regression screenshots.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-08T16:56:35.145567227Z","created_by":"ubuntu","updated_at":"2026-02-08T20:19:02.229469352Z","closed_at":"2026-02-08T20:19:02.229436290Z","close_reason":"Completed fixture identification + mobile before captures","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17l.1.1","depends_on_id":"bd-17l.1","type":"parent-child","created_at":"2026-02-08T16:56:35.145567227Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-17l.1.2","title":"Implement Markdown Table Postprocessing (data-label + shape classes)","description":"SCOPE\n- Enhance public/beads-viewer/viewer.js renderMarkdown() to postprocess sanitized DOM output.\n\nMOTIVATION\n- CSS alone can't reliably turn a table into a mobile-friendly stacked layout without labels.\n- We need header-derived labels (thead/th) to be available on each cell.\n\nDESIGN\n- Pipeline:\n  1) marked.parse(text) -> HTML\n  2) DOMPurify.sanitize(html, { RETURN_DOM_FRAGMENT: true }) -> safe DOM fragment\n  3) enhanceTables(fragment):\n     - For each table:\n       - Extract headers: <thead> <th> textContent, trimmed.\n       - Count columns; add class:\n         - bv-table bv-table--2col (exactly 2 cols)\n         - bv-table bv-table--ncol (>=3 cols)\n       - For each tbody row, for each td index i:\n         - Set td.dataset.label = headers[i] (or '' if missing)\n       - Add data-bv-table=1 marker for debugging.\n     - Optional: normalize whitespace, handle tables without <thead> gracefully.\n  4) Serialize fragment back to HTML string for Alpine x-html.\n\nACCEPTANCE CRITERIA\n- For a standard GFM table, each <td> ends up with data-label matching its header cell.\n- For a 2-col table, the table element is tagged so CSS can render key/value cards.\n- No XSS regression: postprocessing runs AFTER DOMPurify sanitization.\n\nTESTS\n- Unit tests: given sample HTML strings (marked output), assert headers extracted and data-labels applied deterministically.\n- Negative tests: tables missing thead, mismatched column counts, nested tables, empty cells.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-08T16:56:46.813172989Z","created_by":"ubuntu","updated_at":"2026-02-08T19:33:16.449954672Z","closed_at":"2026-02-08T19:33:16.449932631Z","close_reason":"Implemented DOMPurify fragment + enhanceTables(data-label/shape classes) + Playwright unit tests","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17l.1.2","depends_on_id":"bd-17l.1","type":"parent-child","created_at":"2026-02-08T16:56:46.813172989Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-17l.1.3","title":"Add Mobile CSS for Table Cards (2-col) + Labeled Rows (N-col)","description":"FILES\n- public/beads-viewer/styles.css\n\nGOAL\n- Use the classes added by bd-17l.1.2 to render tables in a mobile-native format.\n\nDESIGN\n- Desktop/tablet: keep classic table styling (striped rows, borders).\n- Mobile (<= 640px):\n  - .bv-table--2col:\n    - Hide thead visually.\n    - Render each tbody tr as a card with:\n      - First td = key/title (bold, full width)\n      - Second td = value (muted label, wraps naturally)\n    - No internal cell borders.\n  - .bv-table--ncol:\n    - Hide thead visually.\n    - Render each td as a 2-col grid (label/value):\n      - td::before { content: attr(data-label) }\n      - Grid template columns: minmax(7rem, 40%) 1fr (prevents skinny label column)\n    - Render each tr as a card with subtle border + spacing.\n\nACCESSIBILITY\n- If hiding <thead>, prefer a visually-hidden approach instead of display:none so screen readers can still derive context.\n\nACCEPTANCE CRITERIA\n- Mobile: no horizontal scrolling required for typical ledger tables.\n- Mobile: first column/key is never 'skinny'; key/value layout reads naturally.\n- Desktop: table still looks like a table.\n\nDEPENDENCY\n- Depends on bd-17l.1.2 so the classes/data-label exist.\n\nTESTS\n- E2E: screenshot diffs or layout assertions in Playwright at mobile viewport.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-08T16:56:57.750708678Z","created_by":"ubuntu","updated_at":"2026-02-08T19:40:21.773206539Z","closed_at":"2026-02-08T19:40:21.773188154Z","close_reason":"Added mobile-responsive CSS for bv-table 2col/ncol layouts + Playwright layout assertions","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17l.1.3","depends_on_id":"bd-17l.1","type":"parent-child","created_at":"2026-02-08T16:56:57.750708678Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-17l.1.3","depends_on_id":"bd-17l.1.2","type":"blocks","created_at":"2026-02-08T16:57:11.685596014Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-17l.1.4","title":"Table UX: View Toggle (Table vs Cards) + Copy/Export (CSV/TSV)","description":"USER VALUE\n- Some users will prefer classic tables even on mobile (especially for small 3-col tables), while others want card mode.\n- Copying ledger tables into notes/spreadsheets is a common workflow.\n\nFEATURES\n1) Per-table view toggle\n- Default on mobile: card/stacked mode.\n- Provide a small control (e.g., 'View: Cards | Table') per table.\n- Persist preference globally in localStorage (so users don't re-toggle constantly).\n\n2) Copy / export actions\n- 'Copy as TSV' for spreadsheet-friendly paste.\n- 'Download CSV' for offline use.\n\nDESIGN NOTES\n- Because markdown tables are generated HTML, controls must be injected post-render.\n- Avoid breaking sanitization: inject controls into already-sanitized DOM.\n- Make controls unobtrusive; hide unless table is hovered (desktop) or via a small '⋯' button (mobile).\n\nACCEPTANCE CRITERIA\n- On mobile, user can switch a table back to classic table rendering.\n- Copy/export produces correct headers + row values.\n- No page-level horizontal scroll introduced.\n\nTESTS\n- Unit: HTML->TSV/CSV conversion correctness for tricky cells (links, code, line breaks).\n- E2E: toggling persists across modal close/reopen (localStorage).","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-08T16:57:22.012638557Z","created_by":"ubuntu","updated_at":"2026-02-09T00:47:15.194585688Z","closed_at":"2026-02-09T00:47:15.194563115Z","close_reason":"Implemented table view toggle (cards/table), copy TSV, download CSV. 13 E2E tests passing.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17l.1.4","depends_on_id":"bd-17l.1","type":"parent-child","created_at":"2026-02-08T16:57:22.012638557Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-17l.1.4","depends_on_id":"bd-17l.1.2","type":"blocks","created_at":"2026-02-08T16:57:26.132935268Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-17l.1.4","depends_on_id":"bd-17l.1.3","type":"blocks","created_at":"2026-02-08T16:57:26.201310014Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-17l.1.5","title":"A11y: Responsive Tables Keep Context (SR-only headers, focus, contrast)","description":"SCOPE\n- Ensure responsive table transformations do not make the content worse for accessibility.\n\nCHECKLIST\n- When hiding <thead> on mobile, do it via a visually-hidden pattern (not display:none) so screen readers can still navigate by header context.\n- Ensure injected controls (toggle/copy) are keyboard accessible with clear focus states.\n- Ensure color contrast remains AA in both light and dark.\n\nACCEPTANCE CRITERIA\n- VoiceOver/NVDA navigation across a transformed table still communicates header/label context.\n- No focus traps introduced in the issue modal.\n\nDEPENDS ON\n- bd-17l.1.2 + bd-17l.1.3 (actual transformation implementation).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-08T16:57:34.817254067Z","created_by":"ubuntu","updated_at":"2026-02-09T00:59:08.256605017Z","closed_at":"2026-02-09T00:59:08.256584548Z","close_reason":"Fixed: focus ring uses --bv-cyan (was undefined --bv-accent), button text uses --bv-fg (better contrast), modal has role=dialog + aria-modal + focus trap. SR-only headers already correct. 4 new a11y E2E tests.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17l.1.5","depends_on_id":"bd-17l.1","type":"parent-child","created_at":"2026-02-08T16:57:34.817254067Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-17l.1.5","depends_on_id":"bd-17l.1.2","type":"blocks","created_at":"2026-02-08T16:57:38.842830856Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-17l.1.5","depends_on_id":"bd-17l.1.3","type":"blocks","created_at":"2026-02-08T16:57:38.910234755Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-17l.2","title":"Revision Types: Badge System + Legend (Desktop hover, Mobile tap)","description":"PROBLEM\n- Users see a 'revision type' indicator (10 categories), but without a legend it is opaque.\n- Hover tooltips don't exist on mobile; we need a touch-native way to explain the type mapping.\n\nGOALS\n- Single source of truth mapping for 10 revision categories -> label, color, icon, description.\n- Desktop: hover tooltip (and title fallback) for badges.\n- Mobile: tap-to-open legend (bottom sheet/popover) that explains all categories.\n\nDESIGN\n- Expose the legend via an info button adjacent to anywhere the badge appears.\n- Prefer progressive disclosure:\n  - On small screens, show compact badge; user taps for legend.\n  - On desktop, keep UI clean but allow hover + keyboard focus.\n\nACCEPTANCE CRITERIA\n- In a touch-only environment, the user can discover what each revision type means.\n- Legend is accessible (keyboard focus, ARIA labels).\n\nTESTS\n- Unit tests for parsing -> category classification.\n- E2E tests ensuring legend opens on mobile viewport and closes reliably.","status":"in_progress","priority":1,"issue_type":"epic","created_at":"2026-02-08T16:57:47.788169893Z","created_by":"ubuntu","updated_at":"2026-02-09T00:59:58.525403710Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-17l.2","depends_on_id":"bd-17l","type":"parent-child","created_at":"2026-02-08T16:57:47.788169893Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2eu","title":"Spec Evolution Lab: UX + Forensic Features","description":"CONTEXT\\n- The Spec Evolution Lab is a single-file, self-contained HTML forensic browser at:\\n  public/how-it-was-built/visualization_of_the_evolution_of_the_frankentui_specs_document_from_inception.html\\n- It reconstructs spec history from git (docs/spec + docs/specs) and overlays manual categorization into 10 buckets.\\n\\nGOALS\\n- Make the evolution browsing experience Stripe-level polished on desktop and mobile.\\n- Add high-leverage forensic features: search, deep links, compare modes, timeline playback, and richer metrics (lines/tokens/edit distance) while keeping the page stable and fast.\\n- Preserve the single-file requirement (no extra build pipeline, no extra API).\\n\\nNON-GOALS\\n- No conversion into a full app route with backend services.\\n- No dependency bloat unless it is clearly simpler/safer than bespoke code.\\n\\nQUALITY BAR\\n- Unit tests for any pure functions (metrics, parsing, state encode/decode). Prefer Bun's built-in test runner.\\n- E2E Playwright tests with deterministic logging: JSONL logs containing env, viewport, timings, console events, and failure screenshots.\\n- No console errors in the happy path; fail the E2E run if any appear.\\n\\nDELIVERABLE\\n- A set of sub-beads with clear dependencies + acceptance criteria that implement the features + tests.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-02-08T18:23:00.200365889Z","created_by":"ubuntu","updated_at":"2026-02-08T23:16:24.572374671Z","closed_at":"2026-02-08T23:16:24.572355815Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2eu.1","title":"Spec Evolution Lab: E2E Smoke Tests + JSONL Logging","description":"SCOPE\\n- Add Playwright E2E coverage specifically for:\\n  /how-it-was-built/visualization_of_the_evolution_of_the_frankentui_specs_document_from_inception.html\\n\\nGOALS\\n- Catch UI/JS regressions immediately (especially CDN/lib failures and DOM changes).\\n- Provide rich diagnostics when something breaks.\\n\\nDESIGN\\n- Test matrix:\\n  - Desktop viewport (e.g. 1440x900)\\n  - Mobile viewport (e.g. 390x844)\\n- Assertions:\\n  - Page loads and bootstrap completes (commit list populated).\\n  - Switching tabs works: Diff, Snapshot, Ledger, Files.\\n  - Snapshot renders markdown content with at least one table transformed on mobile.\\n  - Clicking a bucket chip opens the bucket info dialog and the dialog is closable.\\n  - No console errors or pageerrors.\\n- Logging:\\n  - Emit JSONL lines per test run with:\\n    - run_id, timestamp, viewport, URL\\n    - timings (domcontentloaded/load/bootstrap)\\n    - console events (type, text)\\n    - request failures (url, errorText)\\n    - screenshot paths for failures\\n\\nACCEPTANCE CRITERIA\\n- Running the suite locally is one command and produces deterministic logs.\\n- Fail the suite if any console.error/pageerror occurs.\\n\\nNOTES\\n- Prefer using existing Playwright setup in this repo (bunx playwright).","notes":"Implemented Playwright smoke coverage + deterministic JSONL diagnostics for the static Spec Evolution Lab page:\n`/how-it-was-built/visualization_of_the_evolution_of_the_frankentui_specs_document_from_inception.html`\n\nCode changes:\n- Extended `tests/war-stories-nav.spec.ts` with `runStaticSpecEvolutionSmoke(...)` helper.\n- Added two viewport tests:\n  - desktop: 1440x900\n  - mobile: 390x844\n\nAssertions implemented:\n- bootstrap completes (`#commitList [data-commit-idx]` populated)\n- tab switching works: Diff, Snapshot, Ledger, Files\n- snapshot markdown includes table rendering; mobile verifies transformed table signal (`data-label` and/or enhanced class)\n- bucket chip opens bucket info dialog and dialog closes reliably\n- run fails on `console.error`, `pageerror`, or request failures\n\nDiagnostics logging:\n- JSONL file: `test-results/logs/spec-evolution-static-e2e.jsonl`\n- Each record includes run_id, timestamp, viewport, URL, timings (domcontentloaded/load/bootstrap/total), console events, page errors, request failures, status, and failure screenshot path.\n\nValidation command:\n- `BASE_URL=http://127.0.0.1:<port> bunx playwright test tests/war-stories-nav.spec.ts -g \"spec evolution static html\"`\n- Latest run: 2/2 passing.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-08T18:23:35.246422767Z","created_by":"ubuntu","updated_at":"2026-02-08T20:31:07.429344234Z","closed_at":"2026-02-08T20:31:07.429322403Z","close_reason":"Implemented static Spec Evolution Lab E2E smoke tests with deterministic JSONL diagnostics","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2eu.1","depends_on_id":"bd-2eu","type":"parent-child","created_at":"2026-02-08T18:23:35.246422767Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2eu.2","title":"Spec Evolution Lab: Deep-Linkable State (Commit/Tab/File/Filter)","description":"PROBLEM\\n- Today the URL hash only persists the selected commit and active tab.\\n- Users can not reliably share a link that preserves the full investigative context (selected spec file, diff format, search query, reviewed-only toggle, bucket filter).\\n\\nGOAL\\n- Make the lab shareable and 'session-like' with a robust, backwards-compatible (within this tool) URL hash encoding of state.\\n\\nSTATE MODEL\\n- Required:\\n  - selected commit short SHA\\n  - active tab (diff/snapshot/raw/ledger/files)\\n- Add:\\n  - selected snapshot file (or __ALL__)\\n  - diff format (inline vs side-by-side)\\n  - search query for commit list\\n  - reviewed-only toggle\\n  - bucket filter (single bucket)\\n\\nDESIGN\\n- Use a single compact hash payload, e.g.:\\n  #c=<short>&tab=<tab>&f=<file>&d=<diffFmt>&q=<search>&ro=0|1&b=<bucket>\\n- Parsing must be resilient: ignore unknown keys; clamp invalid values.\\n- On every state change, update hash without adding history entries (replaceState).\\n\\nACCEPTANCE CRITERIA\\n- Copy Link always reproduces the same view on reload (including file + filter).\\n- Hash parsing never throws (even with partial/invalid hashes).\\n\\nTESTS\\n- Unit: state encode/decode roundtrip; invalid input clamps and defaults.\\n- E2E: load URL with full state and assert UI reflects it.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-08T18:23:47.562474853Z","created_by":"ubuntu","updated_at":"2026-02-08T22:30:07.611709559Z","closed_at":"2026-02-08T22:30:07.611689742Z","close_reason":"Deep-linkable state implemented with URL hash encoding/decoding. State persisted: commit SHA, active tab, file choice, diff format, search query, reviewed-only toggle, bucket filter. Hash parsing resilient to invalid input. E2E tests: roundtrip restore + invalid hash resilience.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2eu.2","depends_on_id":"bd-2eu","type":"parent-child","created_at":"2026-02-08T18:23:47.562474853Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2eu.3","title":"Spec Evolution Lab: Compare Mode (Pin A, Scrub B, Diff + Metrics)","description":"USER VALUE\\n- Investigations often require comparing non-adjacent commits (not just prev→current).\\n- A pin/scrub workflow matches how people use git blame/log in practice.\\n\\nGOAL\\n- Add an A/B compare mode:\\n  - Pin a baseline commit A\\n  - Scrub/select a target commit B\\n  - View diff/metrics between A and B\\n\\nDESIGN\\n- UI\\n  - Add a small 'Pin as A' action for the current commit.\\n  - When A is pinned, show a 2nd scrubber for B or reuse the existing scrubber with a visible A marker.\\n  - Provide a one-click swap A↔B.\\n- Diff\\n  - Default to showing git patch for commit B (existing) but add a 'Corpus diff A→B' mode that diffs the reconstructed snapshots (markdown/raw).\\n- Metrics\\n  - Compute A→B deltas for:\\n    - lines, bytes\\n    - edit distance (line-level)\\n    - per-file change summary (added/removed/modified counts)\\n\\nACCEPTANCE CRITERIA\\n- User can compare any two commits without losing their place.\\n- Compare mode is obvious but not intrusive when off.\\n\\nTESTS\\n- Unit: snapshot aggregation + diff/metrics functions are deterministic.\\n- E2E: pin A, scrub B, verify metrics panel updates and no console errors.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-08T18:23:59.582764448Z","created_by":"ubuntu","updated_at":"2026-02-08T22:25:23.092270122Z","closed_at":"2026-02-08T22:25:23.092246839Z","close_reason":"Compare mode fully implemented with unit tests (34 passing) and E2E tests (2 passing). Features: Pin A, Scrub B, Swap A↔B, Clear, metrics panel (Δ lines, Δ bytes, file summary), corpus diff A→B mode.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2eu.3","depends_on_id":"bd-2eu","type":"parent-child","created_at":"2026-02-08T18:23:59.582764448Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2eu.4","title":"Spec Evolution Lab: Full-Text Search (Corpus + Diffs)","description":"PROBLEM\\n- The current search only filters by commit subject/short SHA.\\n- When investigating a spec, users need to find when a concept/string first appeared and how it evolved.\\n\\nGOAL\\n- Add full-text search over:\\n  1) Current snapshot corpus (fast, in-page)\\n  2) All commits' snapshots/diffs (heavier; allow progressive indexing)\\n\\nDESIGN\\n- Search scopes:\\n  - 'This commit' (default): search inside the rendered snapshot markdown (DOM text) + raw snapshot text.\\n  - 'All commits': build a lightweight inverted index over commit snapshots in memory.\\n    - Use incremental indexing: index N commits per idle frame (requestIdleCallback), show progress.\\n    - Allow cancel.\\n- Result UX:\\n  - Show a results tray with:\\n    - commit short SHA + date\\n    - snippet + highlighted match\\n    - file path(s) if available\\n  - Tap result selects commit and scrolls to match in Snapshot view.\\n\\nACCEPTANCE CRITERIA\\n- Users can answer 'when did X first appear?' within seconds.\\n- Search is usable on mobile and does not freeze the UI.\\n\\nTESTS\\n- Unit: indexing/search is deterministic; incremental builder yields correct final results.\\n- E2E: search finds a known term and navigates to the right commit.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-08T18:24:11.671372735Z","created_by":"ubuntu","updated_at":"2026-02-08T22:56:49.725531302Z","closed_at":"2026-02-08T22:56:49.725431626Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2eu.4","depends_on_id":"bd-2eu","type":"parent-child","created_at":"2026-02-08T18:24:11.671372735Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2eu.4","depends_on_id":"bd-2eu.7","type":"blocks","created_at":"2026-02-08T18:25:41.095425506Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2eu.5","title":"Spec Evolution Lab: Timeline Mini-map + Playback","description":"USER VALUE\\n- The scrubber works, but it is not expressive: it does not show where change density is high, and it doesn't enable 'play' to see evolution as an animation.\\n\\nGOAL\\n- Add a bottom timeline that makes the entire evolution legible at a glance and supports playback.\\n\\nDESIGN\\n- Timeline mini-map\\n  - Render a compact sparkline/heat strip for the selected metric across commits.\\n  - Overlay markers for reviewed vs unreviewed and bucket-filter matches.\\n  - Clicking a region jumps the scrubber to the nearest commit.\\n- Playback\\n  - Play/pause with speed control (0.25x/0.5x/1x/2x).\\n  - Respect prefers-reduced-motion: disable autoplay by default and cap speed.\\n  - During playback: update the active commit + keep chart selection synced.\\n\\nACCEPTANCE CRITERIA\\n- Users can quickly find 'bursty' periods and play through them.\\n- On mobile, the timeline is finger-friendly and does not introduce accidental scroll traps.\\n\\nTESTS\\n- Unit: timeline scale mapping is correct and monotonic.\\n- E2E: play toggles state and advances commit index deterministically with mocked timers.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-08T18:24:22.323936729Z","created_by":"ubuntu","updated_at":"2026-02-08T23:04:00.318508390Z","closed_at":"2026-02-08T23:04:00.318472032Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2eu.5","depends_on_id":"bd-2eu","type":"parent-child","created_at":"2026-02-08T18:24:22.323936729Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2eu.5","depends_on_id":"bd-2eu.6","type":"blocks","created_at":"2026-02-08T18:25:33.343168888Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2eu.6","title":"Spec Evolution Lab: Metrics Panel v2 (Tokens/Bytes/Edit Distance/Per-File)","description":"PROBLEM\\n- The lab currently exposes only a few coarse metrics (lines, patch bytes, and a line-level edit distance computed on demand).\\n- Investigations benefit from multiple orthogonal measures (tokens, chars, per-file deltas) and transparent computation.\\n\\nGOAL\\n- Add a metrics panel that quantifies changes robustly and explains what each metric means.\\n\\nMETRICS\\n- Always-on (cheap):\\n  - files changed, +/-, patch bytes\\n  - snapshot bytes/lines/words (already in dataset snapshot meta)\\n- On-demand (potentially expensive):\\n  - line-level Levenshtein A→B (existing for prev→current; generalize for compare mode)\\n  - character-level edit distance with early-exit bound\\n  - token counts (approx):\\n    - a) whitespace tokenization (fast baseline)\\n    - b) optional tokenizer (if we later embed a WASM tokenizer)\\n- Per-file breakdown: which spec file contributed most to the delta.\\n\\nDESIGN\\n- Show metric definitions inline (small 'what is this?' affordance) with mobile-friendly dialog.\\n- For expensive metrics: show progress + time and allow cancel; cache per (A,B) pair in-memory.\\n\\nACCEPTANCE CRITERIA\\n- Users can switch metrics without freezing the page.\\n- Metrics are clearly defined (no misleading precision).\\n\\nTESTS\\n- Unit: metric functions deterministic; cache keying correct; early-exit works.\\n- E2E: run a known metric computation and assert the UI updates.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-08T18:24:33.700103038Z","created_by":"ubuntu","updated_at":"2026-02-08T22:33:40.042757953Z","closed_at":"2026-02-08T22:33:40.042738426Z","close_reason":"Metrics Panel v2 implemented: added Δ_WORDS metric, auto-computed cached edit distance (line-level Levenshtein), per-file contribution breakdown sorted by absolute byte delta, info tooltip affordances on all metrics. 38 unit tests + 8 E2E tests all passing.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2eu.6","depends_on_id":"bd-2eu","type":"parent-child","created_at":"2026-02-08T18:24:33.700103038Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2eu.6","depends_on_id":"bd-2eu.3","type":"blocks","created_at":"2026-02-08T18:25:29.123144707Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2eu.7","title":"Spec Evolution Lab: Performance Hardening (Lazy Diff, Virtual Lists, Cache)","description":"PROBLEM\\n- The dataset is large and the UI renders heavy views (Diff2Html, full markdown snapshots).\\n- On lower-end devices, naïve rerenders can cause jank or long main-thread stalls.\\n\\nGOAL\\n- Keep interactions smooth on mobile while preserving full fidelity.\\n\\nSTRATEGY\\n- Lazy render heavy tabs:\\n  - Only construct Diff2Html UI the first time Diff tab is opened for a commit; cache per commit+format.\\n  - Only render markdown snapshot when Snapshot tab is active; avoid re-render when toggling unrelated UI state.\\n- Virtualize long commit lists (desktop sidebar and mobile commits dialog).\\n- Cache computed artifacts:\\n  - sanitized markdown HTML per (commit,file selection)\\n  - parsed patch or Diff2Html DOM per commit\\n  - metric computations per (A,B)\\n- Add a perf diagnostics mode:\\n  - capture render times for key operations and expose in the UI (dev-only toggle).\\n\\nACCEPTANCE CRITERIA\\n- Scrubbing commits stays responsive on a 390px viewport with a large dataset.\\n- No runaway memory growth during extended usage.\\n\\nTESTS\\n- Unit: cache keying and invalidation rules.\\n- E2E: basic performance sanity (no >2s long tasks during scrubbing) using page.performance timings.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-08T18:24:46.672616232Z","created_by":"ubuntu","updated_at":"2026-02-08T22:50:18.649146688Z","closed_at":"2026-02-08T22:50:18.649063593Z","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2eu.7","depends_on_id":"bd-2eu","type":"parent-child","created_at":"2026-02-08T18:24:46.672616232Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
{"id":"bd-2eu.8","title":"Spec Evolution Lab: A11y + Mobile Polish Pass","description":"GOAL\\n- Make the lab feel 'finished' on mobile and accessible via keyboard/screen readers where feasible.\\n\\nCHECKLIST\\n- Dialogs\\n  - Ensure all dialogs have focusable close actions, Esc close, and no focus traps regressions.\\n  - Ensure button labels are explicit (aria-label where needed).\\n- Touch ergonomics\\n  - Ensure primary controls are reachable (consider sticky bottom bar for timeline + tabs).\\n  - Ensure tap targets are >= 44px where appropriate.\\n- Reduce motion\\n  - Respect prefers-reduced-motion for any playback/animation features.\\n- Typography\\n  - Ensure tables, code blocks, and long tokens wrap or scroll intentionally without breaking layout.\\n\\nACCEPTANCE CRITERIA\\n- Mobile: no accidental horizontal scrolling; UI feels deliberate.\\n- Keyboard: user can navigate tabs and open/close dialogs without mouse.\\n\\nTESTS\\n- E2E: basic a11y smoke (tabbing, Esc close).\\n- Manual: iOS Safari sanity pass.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-08T18:24:56.383819206Z","created_by":"ubuntu","updated_at":"2026-02-08T23:16:12.623790799Z","closed_at":"2026-02-08T23:16:12.623769259Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2eu.8","depends_on_id":"bd-2eu","type":"parent-child","created_at":"2026-02-08T18:24:56.383819206Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2eu.8","depends_on_id":"bd-2eu.1","type":"blocks","created_at":"2026-02-08T18:25:47.931618757Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2eu.8","depends_on_id":"bd-2eu.2","type":"blocks","created_at":"2026-02-08T18:25:47.481578050Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2eu.8","depends_on_id":"bd-2eu.3","type":"blocks","created_at":"2026-02-08T18:25:47.553943288Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2eu.8","depends_on_id":"bd-2eu.4","type":"blocks","created_at":"2026-02-08T18:25:47.631485390Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2eu.8","depends_on_id":"bd-2eu.5","type":"blocks","created_at":"2026-02-08T18:25:47.708347879Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2eu.8","depends_on_id":"bd-2eu.6","type":"blocks","created_at":"2026-02-08T18:25:47.781259340Z","created_by":"ubuntu","metadata":"{}","thread_id":""},{"issue_id":"bd-2eu.8","depends_on_id":"bd-2eu.7","type":"blocks","created_at":"2026-02-08T18:25:47.856750502Z","created_by":"ubuntu","metadata":"{}","thread_id":""}]}
